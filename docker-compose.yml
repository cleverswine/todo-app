# Docker Compose configuration for the Todo App
#
# Usage:
#   Build and start: docker-compose up --build
#   Start in background: docker-compose up -d
#   Stop: docker-compose down
#   View logs: docker-compose logs -f

services:
  todo-app:
    # Build the image from the Dockerfile in current directory
    build:
      context: .
      dockerfile: Dockerfile

    # Container name for easier reference
    container_name: todo-app

    # Environment variables used inside the container (e.g., for database path)
    environment:
      - NODE_ENV=production
      - PORT=3000
      - HOST=0.0.0.0
      - DATABASE_URL=/app/data/${DATABASE_NAME}

    # Load environment variables from .env file
    env_file:
      - .env

    # Map port 3000 in container to port 3000 on host
    # Change the first number to use a different host port (e.g., 8080:3000)
    ports:
      - '${EXTERNAL_PORT}:3000'

    # Persist SQLite database outside the container
    # This ensures data survives container restarts/rebuilds
    volumes:
      - ${DATABASE_EXTERNAL_PATH}:/app/data

    # Restart policy - restart unless explicitly stopped
    restart: unless-stopped

    # Health check configuration (also defined in Dockerfile)
    healthcheck:
      test: ['CMD', 'wget', '--no-verbose', '--tries=1', '--spider', 'http://localhost:3000/']
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
